In the process of re-writing this from scratch.

Disregard the lack of semicolons. There was a reason for it.
